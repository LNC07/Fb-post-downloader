<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FB Post Downloader</title>
<style>
  body { font-family: Arial; text-align:center; padding:30px; background:#f5f5f5; }
  input { width:80%; padding:10px; margin:10px 0; border-radius:8px; border:1px solid #ccc; }
  button { padding:10px 20px; border-radius:8px; border:none; background:#1877f2; color:#fff; cursor:pointer; }
  pre { text-align:left; background:#eee; padding:15px; border-radius:8px; overflow-x:auto; max-height:300px; }
  a { display:block; margin:5px 0; color:green; }
</style>
</head>
<body>
<h2>Facebook Post Downloader</h2>
<input type="text" id="fbUrl" placeholder="Enter Facebook Post or Page URL">
<button onclick="downloadFB()">Download</button>

<div id="result"></div>

<script>
async function downloadFB() {
    const url = document.getElementById("fbUrl").value.trim();
    const resultDiv = document.getElementById("result");
    if (!url) { alert("Enter a URL"); return; }

    resultDiv.innerHTML = "<p>‚è≥ Starting Actor... please wait</p>";

    const API_TOKEN = "apify_api_EhgX7HS6tn909T1D6SC2mvLbHZzXLV0UD2ac";
    const payload = { startUrls:[{url}], resultsLimit:5, captionText:false };

    try {
        // 1Ô∏è‚É£ Start Actor run
        const runRes = await fetch(`https://api.apify.com/v2/acts/KoJrdxJCTtpon81KY~default/runs?token=${API_TOKEN}`, {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify(payload)
        });
        const runData = await runRes.json();
        const runId = runData.data.id;

        resultDiv.innerHTML = "<p>‚è≥ Actor running... checking status</p>";

        // 2Ô∏è‚É£ Polling until Actor is SUCCEEDED
        let status = "";
        while(status !== "SUCCEEDED") {
            const statusRes = await fetch(`https://api.apify.com/v2/actor-runs/${runId}?token=${API_TOKEN}`);
            const statusData = await statusRes.json();
            status = statusData.data.status;
            console.log("Status:", status);
            if(status === "FAILED") { resultDiv.innerHTML="<p>‚ùå Actor Failed</p>"; return; }
            await new Promise(r => setTimeout(r, 5000)); // 5 sec wait
        }

        // 3Ô∏è‚É£ Fetch dataset
        const datasetId = runData.data.defaultDatasetId || runData.data.defaultDatasetId; 
        if(!datasetId) { resultDiv.innerHTML="<p>‚ùå No dataset found</p>"; return; }

        const datasetRes = await fetch(`https://api.apify.com/v2/datasets/${datasetId}/items?token=${API_TOKEN}&format=json`);
        const items = await datasetRes.json();

        if(items.length===0){ resultDiv.innerHTML="<p>‚ùå No posts found</p>"; return; }

        // 4Ô∏è‚É£ Show results
        let html = "<h3>‚úÖ Results:</h3>";
        items.forEach((post,i)=>{
            html += `<h4>Post ${i+1}</h4>`;
            if(post.image) html += `<a href="${post.image}" target="_blank">üì∑ Image Link</a>`;
            if(post.video) html += `<a href="${post.video}" target="_blank">üé• Video Link</a>`;
            if(post.text) html += `<pre>${post.text}</pre>`;
        });
        resultDiv.innerHTML = html;

    } catch(err) {
        resultDiv.innerHTML = "<p>‚ùå Error: "+err.message+"</p>";
    }
}
</script>
</body>
</html>
